# Solução para erros de módulos ESM no Heroku com Node.js 22

## Problema

Quando você faz deploy no Heroku, pode enfrentar o erro:
`Error [ERR_MODULE_NOT_FOUND]: Cannot find package '@jridgewell/trace-mapping'`

Isso acontece porque o Node.js 22 no Heroku tem um comportamento diferente com módulos ESM.

## Solução

### 1. Definir a versão do Node.js

Crie ou edite o arquivo `package.json` e adicione:

```json
"engines": {
  "node": "22.x"
}
```

### 2. Especificar variáveis de ambiente

No Heroku, configure:

```
heroku config:set NODE_OPTIONS="--experimental-specifier-resolution=node"
```

### 3. Atualizar o Procfile

Seu Procfile deve conter:

```
web: npm start
```

### 4. Certificar-se que o package.json tem o script start

```json
"scripts": {
  "start": "NODE_ENV=production node dist/server/index.js"
}
```

### 5. Verificar que você tem um processo de build claro

```json
"scripts": {
  "build": "vite build && tsc",
  "heroku-postbuild": "npm run build"
}
```

## Importante

- A integração com For4Payments foi restaurada e adaptada para funcionar com Node.js 22
- A integração usa a rota `/api/payments/pix-python` ou `/api/payments/pix` do backend
- O valor fixo para o kit de segurança (R$ 84,70) está configurado na integração
- Certifique-se que a variável de ambiente `FOR4PAYMENTS_SECRET_KEY` está configurada